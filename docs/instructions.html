<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Instructions | A Course on Price Indices</title>
  <meta name="description" content="A modern and straightforward introduction to price indices" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Instructions | A Course on Price Indices" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A modern and straightforward introduction to price indices" />
  <meta name="github-repo" content="ppd-dpp/price-index-course" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Instructions | A Course on Price Indices" />
  
  <meta name="twitter:description" content="A modern and straightforward introduction to price indices" />
  

<meta name="author" content="Steve Martin" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="structure.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="align.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Introduction to Price Indices</b></span></li>
<li class="chapter" data-level="" data-path="syllabus-for-introduction-to-price-indices.html"><a href="syllabus-for-introduction-to-price-indices.html"><i class="fa fa-check"></i>Syllabus for Introduction to Price Indices</a></li>
<li class="chapter" data-level="" data-path="whats-a-price-index-and-why-do-we-need-one.html"><a href="whats-a-price-index-and-why-do-we-need-one.html"><i class="fa fa-check"></i>What’s a price index and why do we need one?</a>
<ul>
<li class="chapter" data-level="" data-path="whats-a-price-index.html"><a href="whats-a-price-index.html"><i class="fa fa-check"></i>What’s a price index?</a></li>
<li class="chapter" data-level="" data-path="uses-of-a-price-index.html"><a href="uses-of-a-price-index.html"><i class="fa fa-check"></i>Uses of a price index</a></li>
<li class="chapter" data-level="" data-path="why-a-price-index.html"><a href="why-a-price-index.html"><i class="fa fa-check"></i>Why a price index?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index-number-formula.html"><a href="index-number-formula.html"><i class="fa fa-check"></i>Index-number formula</a>
<ul>
<li class="chapter" data-level="" data-path="arithmetic-price-indices.html"><a href="arithmetic-price-indices.html"><i class="fa fa-check"></i>Arithmetic price indices</a></li>
<li class="chapter" data-level="" data-path="common-arithmetic-indices.html"><a href="common-arithmetic-indices.html"><i class="fa fa-check"></i>Common arithmetic indices</a></li>
<li class="chapter" data-level="" data-path="less-common-arithmetic-indices.html"><a href="less-common-arithmetic-indices.html"><i class="fa fa-check"></i>Less common arithmetic indices</a></li>
<li class="chapter" data-level="" data-path="geometric-price-indices.html"><a href="geometric-price-indices.html"><i class="fa fa-check"></i>Geometric price indices</a></li>
<li class="chapter" data-level="" data-path="the-fisher-index.html"><a href="the-fisher-index.html"><i class="fa fa-check"></i>The Fisher index</a></li>
<li class="chapter" data-level="" data-path="example-with-r-index-number-formulas.html"><a href="example-with-r-index-number-formulas.html"><i class="fa fa-check"></i>Example with R: Index-number formulas</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="computing-a-price-index.html"><a href="computing-a-price-index.html"><i class="fa fa-check"></i>Computing a price index</a>
<ul>
<li class="chapter" data-level="" data-path="sub-indices-and-aggregation.html"><a href="sub-indices-and-aggregation.html"><i class="fa fa-check"></i>Sub-indices and aggregation</a></li>
<li class="chapter" data-level="" data-path="factoring-an-index.html"><a href="factoring-an-index.html"><i class="fa fa-check"></i>Factoring an index</a></li>
<li class="chapter" data-level="" data-path="rebasing.html"><a href="rebasing.html"><i class="fa fa-check"></i>Rebasing</a></li>
<li class="chapter" data-level="" data-path="chaining.html"><a href="chaining.html"><i class="fa fa-check"></i>Chaining</a></li>
<li class="chapter" data-level="" data-path="example-with-r-consistency-in-aggregation-and-rebasing.html"><a href="example-with-r-consistency-in-aggregation-and-rebasing.html"><i class="fa fa-check"></i>Example with R: Consistency in aggregation and rebasing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="assignment-1.html"><a href="assignment-1.html"><i class="fa fa-check"></i>Assignment 1</a></li>
<li class="part"><span><b>II Price Index Theory</b></span></li>
<li class="chapter" data-level="" data-path="syllabus-for-price-index-theory.html"><a href="syllabus-for-price-index-theory.html"><i class="fa fa-check"></i>Syllabus for Price Index Theory</a></li>
<li class="chapter" data-level="" data-path="what-is-price-index-theory.html"><a href="what-is-price-index-theory.html"><i class="fa fa-check"></i>What is price-index theory?</a></li>
<li class="chapter" data-level="" data-path="the-axiomatic-approach.html"><a href="the-axiomatic-approach.html"><i class="fa fa-check"></i>The axiomatic approach</a>
<ul>
<li class="chapter" data-level="" data-path="an-abstract-price-index.html"><a href="an-abstract-price-index.html"><i class="fa fa-check"></i>An abstract price index</a></li>
<li class="chapter" data-level="" data-path="the-axioms.html"><a href="the-axioms.html"><i class="fa fa-check"></i>The axioms</a></li>
<li class="chapter" data-level="" data-path="counter-examples.html"><a href="counter-examples.html"><i class="fa fa-check"></i>Counter examples</a></li>
<li class="chapter" data-level="" data-path="the-tests.html"><a href="the-tests.html"><i class="fa fa-check"></i>The tests</a></li>
<li class="chapter" data-level="" data-path="an-impossibility-result.html"><a href="an-impossibility-result.html"><i class="fa fa-check"></i>An impossibility result</a></li>
<li class="chapter" data-level="" data-path="motivating-the-jevons-and-laspeyres-indices.html"><a href="motivating-the-jevons-and-laspeyres-indices.html"><i class="fa fa-check"></i>Motivating the Jevons and Laspeyres indices</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-economic-approach.html"><a href="the-economic-approach.html"><i class="fa fa-check"></i>The economic approach</a>
<ul>
<li class="chapter" data-level="" data-path="input-price-index.html"><a href="input-price-index.html"><i class="fa fa-check"></i>Input-price index</a></li>
<li class="chapter" data-level="" data-path="output-price-index.html"><a href="output-price-index.html"><i class="fa fa-check"></i>Output-price index</a></li>
<li class="chapter" data-level="" data-path="cost-of-living-index.html"><a href="cost-of-living-index.html"><i class="fa fa-check"></i>Cost-of-living index</a></li>
<li class="chapter" data-level="" data-path="approximating-an-economic-index.html"><a href="approximating-an-economic-index.html"><i class="fa fa-check"></i>Approximating an economic index</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-stochastic-approach.html"><a href="the-stochastic-approach.html"><i class="fa fa-check"></i>The stochastic approach</a>
<ul>
<li class="chapter" data-level="" data-path="the-optimal-prediction-problem.html"><a href="the-optimal-prediction-problem.html"><i class="fa fa-check"></i>The optimal prediction problem</a></li>
<li class="chapter" data-level="" data-path="geometric-price-indices-as-a-best-predictor.html"><a href="geometric-price-indices-as-a-best-predictor.html"><i class="fa fa-check"></i>Geometric price indices as a best predictor</a></li>
<li class="chapter" data-level="" data-path="more-general-price-indices.html"><a href="more-general-price-indices.html"><i class="fa fa-check"></i>More general price indices</a></li>
<li class="chapter" data-level="" data-path="statistical-inference.html"><a href="statistical-inference.html"><i class="fa fa-check"></i>Statistical inference</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="assignment-2.html"><a href="assignment-2.html"><i class="fa fa-check"></i>Assignment 2</a></li>
<li class="part"><span><b>III Constant-Quality Price Indices</b></span></li>
<li class="chapter" data-level="" data-path="syllabus-for-constant-quality-price-indices.html"><a href="syllabus-for-constant-quality-price-indices.html"><i class="fa fa-check"></i>Syllabus for Constant-Quality Price Indices</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="potential-prices.html"><a href="potential-prices.html"><i class="fa fa-check"></i>Potential prices</a>
<ul>
<li class="chapter" data-level="" data-path="constant-quality-price-indices.html"><a href="constant-quality-price-indices.html"><i class="fa fa-check"></i>Constant-quality price indices</a></li>
<li class="chapter" data-level="" data-path="transaction-price-indices.html"><a href="transaction-price-indices.html"><i class="fa fa-check"></i>Transaction-price indices</a></li>
<li class="chapter" data-level="" data-path="identification.html"><a href="identification.html"><i class="fa fa-check"></i>Identification</a></li>
<li class="chapter" data-level="" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i>Example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stratified-price-indices.html"><a href="stratified-price-indices.html"><i class="fa fa-check"></i>Stratified price indices</a>
<ul>
<li class="chapter" data-level="" data-path="conditional-independence.html"><a href="conditional-independence.html"><i class="fa fa-check"></i>Conditional independence</a></li>
<li class="chapter" data-level="" data-path="overlap.html"><a href="overlap.html"><i class="fa fa-check"></i>Overlap</a></li>
<li class="chapter" data-level="" data-path="issues-with-stratification.html"><a href="issues-with-stratification.html"><i class="fa fa-check"></i>Issues with stratification</a></li>
<li class="chapter" data-level="" data-path="example-with-r-stratified-index.html"><a href="example-with-r-stratified-index.html"><i class="fa fa-check"></i>Example with R: Stratified index</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hedonic-price-indices.html"><a href="hedonic-price-indices.html"><i class="fa fa-check"></i>Hedonic price indices</a>
<ul>
<li class="chapter" data-level="" data-path="linear-hedonic-indices.html"><a href="linear-hedonic-indices.html"><i class="fa fa-check"></i>Linear hedonic indices</a></li>
<li class="chapter" data-level="" data-path="the-time-dummy-approach.html"><a href="the-time-dummy-approach.html"><i class="fa fa-check"></i>The time-dummy approach</a></li>
<li class="chapter" data-level="" data-path="example-with-r-hedonics.html"><a href="example-with-r-hedonics.html"><i class="fa fa-check"></i>Example with R: Hedonics</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="assignment-3.html"><a href="assignment-3.html"><i class="fa fa-check"></i>Assignment 3</a></li>
<li class="part"><span><b>IV Building a Price Index with R</b></span></li>
<li class="chapter" data-level="" data-path="syllabus-for-building-a-price-index-with-r.html"><a href="syllabus-for-building-a-price-index-with-r.html"><i class="fa fa-check"></i>Syllabus for Building a Price Index with R</a></li>
<li class="chapter" data-level="" data-path="assignment-4.html"><a href="assignment-4.html"><i class="fa fa-check"></i>Assignment 4</a>
<ul>
<li class="chapter" data-level="" data-path="structure.html"><a href="structure.html"><i class="fa fa-check"></i>Structure</a></li>
<li class="chapter" data-level="" data-path="instructions.html"><a href="instructions.html"><i class="fa fa-check"></i>Instructions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Course on Price Indices</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="instructions" class="section level2">
<h2>Instructions</h2>
<p>These instructions outline a simple way to build the price index for widgets, although feel free to use a different approach if it’s easier. The goal is to understand the process, rather than design the most computationally efficient system. In order to ensure that simply following these instructions isn’t a trivial exercise, parts of the code from the snippets below have been omitted and replaced with tags in angle brackets. Wherever you see <code>&lt;action&gt;</code>, you should insert the name of a function. You can think of functions as “verbs” that perform actions on your data. Wherever you see <code>&lt;variable&gt;</code>, you should insert the name of one of your data structures. You can think of variables as “nouns” that you manipulate with “verbs,” or functions. Finally, wherever you see <code>&lt;parameter&gt;</code>, you should insert additional arguments to be passed to a function. You can think of these arguments or parameters as “adverbs” that modify your functions, or “verbs.” In order to help you out, some lines of code have hints next to them marked with <code># **HINT**</code>.</p>
<p>Run the following code to grab all the data files and put them in your working environment. Note that these data aren’t perfect. It is worth remembering to check your intermediate calculations to make sure everything is as expected (e.g., with the <code>summary</code> function).</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="instructions.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;https://raw.githubusercontent.com/ppd-dpp/price-index-course/master/scripts/get_data.R&#39;</span>)</span></code></pre></div>
<p>The <a href="https://cran.r-project.org/package=gpindex">gpindex</a>, and <a href="https://github.com/marberts/piar">piar</a> packages will be used in this module. Install them as follows if they aren’t already installed, and then load them. (Hint: it is worth going through the documentation in the <code>gpindex</code> and <code>piar</code> packages.)</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="instructions.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;gpindex&quot;</span>, <span class="st">&quot;piar&quot;</span>))</span>
<span id="cb44-2"><a href="instructions.html#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="instructions.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gpindex)</span>
<span id="cb44-4"><a href="instructions.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(piar)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><strong>Calculate the period-over-period elemental indices for product K</strong></li>
</ol>
<p>Using the microdata for product K in the <code>micro_prices</code> file, calculate the geometric average of the prices in each province in each month in each reference year. Then, calculate the ratio of the geometric averages computed in step 3, making sure to have a price relative of 1 in January 2018 and January 2019. (January 2019 will be the link month when it is time to chain the index.)</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="instructions.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---- Product &#39;K&#39; index ----</span></span>
<span id="cb45-2"><a href="instructions.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn period into a year-month and combine product and province into a </span></span>
<span id="cb45-3"><a href="instructions.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># factor for elemental aggregates</span></span>
<span id="cb45-4"><a href="instructions.html#cb45-4" aria-hidden="true" tabindex="-1"></a>micro_prices <span class="ot">&lt;-</span> <span class="fu">transform</span>(micro_prices, </span>
<span id="cb45-5"><a href="instructions.html#cb45-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">period =</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(period), <span class="st">&quot;%Y%m&quot;</span>), </span>
<span id="cb45-6"><a href="instructions.html#cb45-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ea =</span> <span class="fu">interaction</span>(province, product, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb45-7"><a href="instructions.html#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="instructions.html#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a single price for each time period by taking the geomean</span></span>
<span id="cb45-9"><a href="instructions.html#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co"># **HINT** Take a look at the documentation for the aggregate methods </span></span>
<span id="cb45-10"><a href="instructions.html#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># in the stats package</span></span>
<span id="cb45-11"><a href="instructions.html#cb45-11" aria-hidden="true" tabindex="-1"></a>micro_prices <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(price <span class="sc">~</span> <span class="er">&lt;</span>variable<span class="sc">&gt;</span> <span class="sc">+</span> <span class="er">&lt;</span>variable<span class="sc">&gt;</span> <span class="sc">+</span> <span class="er">&lt;</span>variable<span class="sc">&gt;</span>,</span>
<span id="cb45-12"><a href="instructions.html#cb45-12" aria-hidden="true" tabindex="-1"></a>                          micro_prices,</span>
<span id="cb45-13"><a href="instructions.html#cb45-13" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">&lt;</span>action<span class="sc">&gt;</span>)</span>
<span id="cb45-14"><a href="instructions.html#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="instructions.html#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate elemental indexes for product &#39;K&#39;</span></span>
<span id="cb45-16"><a href="instructions.html#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co"># **HINT** piar has a function for computing ratios of prices in consecutive months</span></span>
<span id="cb45-17"><a href="instructions.html#cb45-17" aria-hidden="true" tabindex="-1"></a>index_k <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">split</span>(micro_prices, micro_prices<span class="sc">$</span>basket), </span>
<span id="cb45-18"><a href="instructions.html#cb45-18" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">function</span>(df) {</span>
<span id="cb45-19"><a href="instructions.html#cb45-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">with</span>(df, <span class="fu">elemental_index</span>(<span class="sc">&lt;</span>action<span class="sc">&gt;</span>(price, period, ea), period, ea))</span>
<span id="cb45-20"><a href="instructions.html#cb45-20" aria-hidden="true" tabindex="-1"></a>                  })</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Calculate the period-over-period elemental indices for products A through J, and merge them with them with the product K elemental indices</strong></li>
</ol>
<p>Using the data from the Globular Prices System in <code>gps_prices</code>, calculate price relatives for each quote in each province in each month in each reference year and use them to compute elemental indices. Then, merge these indices with the product K indices so that they are all in the same tables. This should give you two tables of elemental indices for products A through K, one for each reference year.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="instructions.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---- Product &#39;A&#39; to &#39;J&#39; indices ----</span></span>
<span id="cb46-2"><a href="instructions.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Melt into a long format</span></span>
<span id="cb46-3"><a href="instructions.html#cb46-3" aria-hidden="true" tabindex="-1"></a>gps_prices <span class="ot">&lt;-</span> <span class="fu">reshape</span>(gps_prices, </span>
<span id="cb46-4"><a href="instructions.html#cb46-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">direction =</span> <span class="sc">&lt;</span>parameter<span class="sc">&gt;</span>, </span>
<span id="cb46-5"><a href="instructions.html#cb46-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">varying =</span> <span class="fu">paste0</span>(<span class="st">&quot;price&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb46-6"><a href="instructions.html#cb46-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">v.names =</span> <span class="st">&quot;price&quot;</span>,</span>
<span id="cb46-7"><a href="instructions.html#cb46-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">timevar =</span> <span class="st">&quot;quote&quot;</span>,</span>
<span id="cb46-8"><a href="instructions.html#cb46-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idvar =</span> <span class="fu">c</span>(<span class="st">&quot;ea&quot;</span>, <span class="st">&quot;period&quot;</span>, <span class="st">&quot;basket&quot;</span>))</span>
<span id="cb46-9"><a href="instructions.html#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="instructions.html#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine quote id and ea labels to make unique product labels</span></span>
<span id="cb46-11"><a href="instructions.html#cb46-11" aria-hidden="true" tabindex="-1"></a>gps_prices<span class="sc">$</span>product <span class="ot">&lt;-</span> <span class="fu">paste0</span>(gps_prices<span class="sc">$</span>ea, gps_prices<span class="sc">$</span>quote)</span>
<span id="cb46-12"><a href="instructions.html#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="instructions.html#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate elemental indexes for product &#39;A&#39; to &#39;J&#39;</span></span>
<span id="cb46-14"><a href="instructions.html#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># **HINT** What type of elemental indices have you been asked to compute? </span></span>
<span id="cb46-15"><a href="instructions.html#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="co"># What type of mean does that imply? What is the corresponding order of the generalized mean?</span></span>
<span id="cb46-16"><a href="instructions.html#cb46-16" aria-hidden="true" tabindex="-1"></a>index_aj <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">split</span>(gps_prices, gps_prices<span class="sc">$</span>basket), </span>
<span id="cb46-17"><a href="instructions.html#cb46-17" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">function</span>(df) {</span>
<span id="cb46-18"><a href="instructions.html#cb46-18" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">with</span>(df, <span class="fu">elemental_index</span>(<span class="sc">&lt;</span>action<span class="sc">&gt;</span>(price, period, product), </span>
<span id="cb46-19"><a href="instructions.html#cb46-19" aria-hidden="true" tabindex="-1"></a>                                             period, ea, <span class="at">na.rm =</span> <span class="sc">&lt;</span>parameter<span class="sc">&gt;</span>, <span class="at">r =</span> <span class="sc">&lt;</span>parameter<span class="sc">&gt;</span>))</span>
<span id="cb46-20"><a href="instructions.html#cb46-20" aria-hidden="true" tabindex="-1"></a>                  })</span>
<span id="cb46-21"><a href="instructions.html#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="instructions.html#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="co">#---- Merge elemental indices ----</span></span>
<span id="cb46-23"><a href="instructions.html#cb46-23" aria-hidden="true" tabindex="-1"></a>elementals <span class="ot">&lt;-</span> <span class="fu">Map</span>(merge, <span class="sc">&lt;</span>variable<span class="sc">&gt;</span>, <span class="sc">&lt;</span>variable<span class="sc">&gt;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><strong>Build the aggregation structures</strong></li>
</ol>
<p>An aggregation structure tells R how to build up your price indices. It indicates how the elemental indices are aggregated to build provincial indices, how the provincial indices are aggregated to build regional indices, and how the regional indices are aggregated to build the national index. It also indicates which weights are assigned to each elemental index in the aggregation. Create one aggregation structure for each year, for a total of two.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="instructions.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---- Aggregation structure ----</span></span>
<span id="cb47-2"><a href="instructions.html#cb47-2" aria-hidden="true" tabindex="-1"></a>pias <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">split</span>(weights, weights<span class="sc">$</span>basket), </span>
<span id="cb47-3"><a href="instructions.html#cb47-3" aria-hidden="true" tabindex="-1"></a>               <span class="cf">function</span>(df) {</span>
<span id="cb47-4"><a href="instructions.html#cb47-4" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">&lt;</span>action<span class="sc">&gt;</span>(df[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], df<span class="sc">$</span>weight)</span>
<span id="cb47-5"><a href="instructions.html#cb47-5" aria-hidden="true" tabindex="-1"></a>               })</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><strong>Aggregate and chain the index</strong></li>
</ol>
<p>Take the elemental indices you calculated in Steps 1 and 2 and the aggregation structures you created in Step 3, and use them to calculate the aggregate indices for provinces, regions, and the entire country. (There is no need to manually price-update the aggregation weights for each month, as <code>piar</code>’s <code>aggregate</code> function will do this automatically.) You should now have a collection of month-over-month indices. Chain the 2018 and 2019 indices together, using January 2019 as the link month, to get an index from January 2018 to December 2019, with January 2018 as the base period.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="instructions.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---- Aggregate, chain, and quarter ----</span></span>
<span id="cb48-2"><a href="instructions.html#cb48-2" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">Map</span>(<span class="sc">&lt;</span>action<span class="sc">&gt;</span>, <span class="sc">&lt;</span>variable<span class="sc">&gt;</span>, pias)</span>
<span id="cb48-3"><a href="instructions.html#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="instructions.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># **HINT** What do you have to remove from the 2019 index in order to chain it </span></span>
<span id="cb48-5"><a href="instructions.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># together with the 2018 index?</span></span>
<span id="cb48-6"><a href="instructions.html#cb48-6" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">chain</span>(<span class="fu">stack</span>(index[[<span class="st">&quot;2018&quot;</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, ], index[[<span class="st">&quot;2019&quot;</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="sc">&lt;</span>parameter<span class="sc">&gt;</span>]))</span></code></pre></div>

</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="structure.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["price-index-course.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
