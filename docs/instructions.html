<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Instructions | A Course on Price Indices</title>
  <meta name="description" content="A modern and straightforward introduction to price indices" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Instructions | A Course on Price Indices" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A modern and straightforward introduction to price indices" />
  <meta name="github-repo" content="ppd-dpp/price-index-course" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Instructions | A Course on Price Indices" />
  
  <meta name="twitter:description" content="A modern and straightforward introduction to price indices" />
  

<meta name="author" content="Steve Martin and Rebecca Meier" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="methodology.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="align.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="part"><span><b>I Introduction to Price Indices</b></span></li>
<li class="chapter" data-level="" data-path="syllabus-for-introduction-to-price-indices.html"><a href="syllabus-for-introduction-to-price-indices.html"><i class="fa fa-check"></i>Syllabus for Introduction to Price Indices</a></li>
<li class="chapter" data-level="" data-path="whats-a-price-index-and-why-do-we-need-one.html"><a href="whats-a-price-index-and-why-do-we-need-one.html"><i class="fa fa-check"></i>What’s a price index and why do we need one?</a><ul>
<li class="chapter" data-level="" data-path="whats-a-price-index.html"><a href="whats-a-price-index.html"><i class="fa fa-check"></i>What’s a price index?</a></li>
<li class="chapter" data-level="" data-path="uses-of-a-price-index.html"><a href="uses-of-a-price-index.html"><i class="fa fa-check"></i>Uses of a price index</a></li>
<li class="chapter" data-level="" data-path="why-a-price-index.html"><a href="why-a-price-index.html"><i class="fa fa-check"></i>Why a price index?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index-number-formula.html"><a href="index-number-formula.html"><i class="fa fa-check"></i>Index-number formula</a><ul>
<li class="chapter" data-level="" data-path="arithmetic-price-indices.html"><a href="arithmetic-price-indices.html"><i class="fa fa-check"></i>Arithmetic price indices</a></li>
<li class="chapter" data-level="" data-path="common-arithmetic-indices.html"><a href="common-arithmetic-indices.html"><i class="fa fa-check"></i>Common arithmetic indices</a></li>
<li class="chapter" data-level="" data-path="less-common-arithmetic-indices.html"><a href="less-common-arithmetic-indices.html"><i class="fa fa-check"></i>Less common arithmetic indices</a></li>
<li class="chapter" data-level="" data-path="geometric-price-indices.html"><a href="geometric-price-indices.html"><i class="fa fa-check"></i>Geometric price indices</a></li>
<li class="chapter" data-level="" data-path="the-fisher-index.html"><a href="the-fisher-index.html"><i class="fa fa-check"></i>The Fisher index</a></li>
<li class="chapter" data-level="" data-path="example-with-r-index-number-formulas.html"><a href="example-with-r-index-number-formulas.html"><i class="fa fa-check"></i>Example with R: Index-number formulas</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="computing-a-price-index.html"><a href="computing-a-price-index.html"><i class="fa fa-check"></i>Computing a price index</a><ul>
<li class="chapter" data-level="" data-path="sub-indices-and-aggregation.html"><a href="sub-indices-and-aggregation.html"><i class="fa fa-check"></i>Sub-indices and aggregation</a></li>
<li class="chapter" data-level="" data-path="factoring-an-index.html"><a href="factoring-an-index.html"><i class="fa fa-check"></i>Factoring an index</a></li>
<li class="chapter" data-level="" data-path="rebasing.html"><a href="rebasing.html"><i class="fa fa-check"></i>Rebasing</a></li>
<li class="chapter" data-level="" data-path="chaining.html"><a href="chaining.html"><i class="fa fa-check"></i>Chaining</a></li>
<li class="chapter" data-level="" data-path="example-with-r-consistency-in-aggregation-and-rebasing.html"><a href="example-with-r-consistency-in-aggregation-and-rebasing.html"><i class="fa fa-check"></i>Example with R: Consistency in aggregation and rebasing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="assignment-1.html"><a href="assignment-1.html"><i class="fa fa-check"></i>Assignment 1</a></li>
<li class="part"><span><b>II Price Index Theory</b></span></li>
<li class="chapter" data-level="" data-path="syllabus-for-price-index-theory.html"><a href="syllabus-for-price-index-theory.html"><i class="fa fa-check"></i>Syllabus for Price Index Theory</a></li>
<li class="chapter" data-level="" data-path="what-is-price-index-theory.html"><a href="what-is-price-index-theory.html"><i class="fa fa-check"></i>What is price-index theory?</a></li>
<li class="chapter" data-level="" data-path="the-axiomatic-approach.html"><a href="the-axiomatic-approach.html"><i class="fa fa-check"></i>The axiomatic approach</a><ul>
<li class="chapter" data-level="" data-path="an-abstract-price-index.html"><a href="an-abstract-price-index.html"><i class="fa fa-check"></i>An abstract price index</a></li>
<li class="chapter" data-level="" data-path="the-axioms.html"><a href="the-axioms.html"><i class="fa fa-check"></i>The axioms</a></li>
<li class="chapter" data-level="" data-path="counter-examples.html"><a href="counter-examples.html"><i class="fa fa-check"></i>Counter examples</a></li>
<li class="chapter" data-level="" data-path="the-tests.html"><a href="the-tests.html"><i class="fa fa-check"></i>The tests</a></li>
<li class="chapter" data-level="" data-path="an-impossibility-result.html"><a href="an-impossibility-result.html"><i class="fa fa-check"></i>An impossibility result</a></li>
<li class="chapter" data-level="" data-path="motivating-the-jevons-and-laspeyres-indices.html"><a href="motivating-the-jevons-and-laspeyres-indices.html"><i class="fa fa-check"></i>Motivating the Jevons and Laspeyres indices</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-economic-approach.html"><a href="the-economic-approach.html"><i class="fa fa-check"></i>The economic approach</a><ul>
<li class="chapter" data-level="" data-path="input-price-index.html"><a href="input-price-index.html"><i class="fa fa-check"></i>Input-price index</a></li>
<li class="chapter" data-level="" data-path="output-price-index.html"><a href="output-price-index.html"><i class="fa fa-check"></i>Output-price index</a></li>
<li class="chapter" data-level="" data-path="cost-of-living-index.html"><a href="cost-of-living-index.html"><i class="fa fa-check"></i>Cost-of-living index</a></li>
<li class="chapter" data-level="" data-path="approximating-an-economic-index.html"><a href="approximating-an-economic-index.html"><i class="fa fa-check"></i>Approximating an economic index</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-stochastic-approach.html"><a href="the-stochastic-approach.html"><i class="fa fa-check"></i>The stochastic approach</a><ul>
<li class="chapter" data-level="" data-path="the-optimal-prediction-problem.html"><a href="the-optimal-prediction-problem.html"><i class="fa fa-check"></i>The optimal prediction problem</a></li>
<li class="chapter" data-level="" data-path="geometric-price-indices-as-a-best-predictor.html"><a href="geometric-price-indices-as-a-best-predictor.html"><i class="fa fa-check"></i>Geometric price indices as a best predictor</a></li>
<li class="chapter" data-level="" data-path="more-general-price-indices.html"><a href="more-general-price-indices.html"><i class="fa fa-check"></i>More general price indices</a></li>
<li class="chapter" data-level="" data-path="statistical-inference.html"><a href="statistical-inference.html"><i class="fa fa-check"></i>Statistical inference</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="assignment-2.html"><a href="assignment-2.html"><i class="fa fa-check"></i>Assignment 2</a></li>
<li class="part"><span><b>III Constant-Quality Price Indices</b></span></li>
<li class="chapter" data-level="" data-path="syllabus-for-constant-quality-price-indices.html"><a href="syllabus-for-constant-quality-price-indices.html"><i class="fa fa-check"></i>Syllabus for Constant-Quality Price Indices</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="potential-prices.html"><a href="potential-prices.html"><i class="fa fa-check"></i>Potential prices</a><ul>
<li class="chapter" data-level="" data-path="constant-quality-price-indices.html"><a href="constant-quality-price-indices.html"><i class="fa fa-check"></i>Constant-quality price indices</a></li>
<li class="chapter" data-level="" data-path="transaction-price-indices.html"><a href="transaction-price-indices.html"><i class="fa fa-check"></i>Transaction-price indices</a></li>
<li class="chapter" data-level="" data-path="identification.html"><a href="identification.html"><i class="fa fa-check"></i>Identification</a></li>
<li class="chapter" data-level="" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i>Example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stratified-price-indices.html"><a href="stratified-price-indices.html"><i class="fa fa-check"></i>Stratified price indices</a><ul>
<li class="chapter" data-level="" data-path="conditional-independence.html"><a href="conditional-independence.html"><i class="fa fa-check"></i>Conditional independence</a></li>
<li class="chapter" data-level="" data-path="overlap.html"><a href="overlap.html"><i class="fa fa-check"></i>Overlap</a></li>
<li class="chapter" data-level="" data-path="issues-with-stratification.html"><a href="issues-with-stratification.html"><i class="fa fa-check"></i>Issues with stratification</a></li>
<li class="chapter" data-level="" data-path="example-with-r-stratified-index.html"><a href="example-with-r-stratified-index.html"><i class="fa fa-check"></i>Example with R: Stratified index</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hedonic-price-indices.html"><a href="hedonic-price-indices.html"><i class="fa fa-check"></i>Hedonic price indices</a><ul>
<li class="chapter" data-level="" data-path="linear-hedonic-indices.html"><a href="linear-hedonic-indices.html"><i class="fa fa-check"></i>Linear hedonic indices</a></li>
<li class="chapter" data-level="" data-path="the-time-dummy-approach.html"><a href="the-time-dummy-approach.html"><i class="fa fa-check"></i>The time-dummy approach</a></li>
<li class="chapter" data-level="" data-path="example-with-r-hedonics.html"><a href="example-with-r-hedonics.html"><i class="fa fa-check"></i>Example with R: Hedonics</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="assignment-3.html"><a href="assignment-3.html"><i class="fa fa-check"></i>Assignment 3</a></li>
<li class="part"><span><b>IV Building a Price Index with R</b></span></li>
<li class="chapter" data-level="" data-path="syllabus-for-building-a-price-index-with-r.html"><a href="syllabus-for-building-a-price-index-with-r.html"><i class="fa fa-check"></i>Syllabus for Building a Price Index with R</a></li>
<li class="chapter" data-level="" data-path="assignment-4.html"><a href="assignment-4.html"><i class="fa fa-check"></i>Assignment 4</a><ul>
<li class="chapter" data-level="" data-path="methodology.html"><a href="methodology.html"><i class="fa fa-check"></i>Methodology</a></li>
<li class="chapter" data-level="" data-path="instructions.html"><a href="instructions.html"><i class="fa fa-check"></i>Instructions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Course on Price Indices</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="instructions" class="section level2">
<h2>Instructions</h2>
<p>These instructions outline a simple way to build the price index for widgets, although feel free to use a different approach if it’s easier. The goal is to understand the process, rather than design the most computationally efficient system.</p>
<p>Run the following code to grab all the data files and put them in your working environment. Note that these data aren’t perfect. It is worth remembering to check your intermediate calculations to make sure everything is as expected (e.g., with the <code>summary</code> function).</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">source</span>(<span class="st">&#39;https://raw.githubusercontent.com/ppd-dpp/price-index-course/master/scripts/get_data.R&#39;</span>)</a></code></pre></div>
<p>The <a href="https://cran.r-project.org/package=dplyr">dplyr</a>, <a href="https://cran.r-project.org/package=tidyr">tidyr</a>, <a href="https://cran.r-project.org/package=gpindex">gpindex</a>, and <a href="https://github.com/ppd-dpp/calpr">calpr</a> packages will be used in this module. Install them as follows if they aren’t already installed. (Hint: it is worth going through the documentation in the <code>gpindex</code> and <code>calpr</code> packages.)</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;tidyr&quot;</span>, <span class="st">&quot;gpindex&quot;</span>, <span class="st">&quot;devtools&quot;</span>))</a>
<a class="sourceLine" id="cb44-2" title="2">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;ppd-dpp/calpr&quot;</span>)</a></code></pre></div>
<ol style="list-style-type: decimal">
<li><p><strong>Make the weights</strong></p>
<p>Using the <code>weights</code> file, make one set of weights that give the value share of all products sold in each province in each year, and another that give the value share of each product sold within each province in each year. This first set of weights will be used to aggregate the province-level indices to a national index, and the second set of weights will be used to aggregate elemental indices to get 10 province-level indices. There should be 20 weights in the first file and 200 weights in the second file.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb45-2" title="2"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb45-3" title="3"><span class="kw">library</span>(gpindex)</a>
<a class="sourceLine" id="cb45-4" title="4"><span class="kw">library</span>(calpr)</a>
<a class="sourceLine" id="cb45-5" title="5"></a>
<a class="sourceLine" id="cb45-6" title="6"><span class="co"># Make provincial weights</span></a>
<a class="sourceLine" id="cb45-7" title="7">weights_prov &lt;-<span class="st"> </span>weights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-8" title="8"><span class="st">  </span><span class="kw">group_by</span>(year, province) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># group all sales values by reference year and province</span></a>
<a class="sourceLine" id="cb45-9" title="9"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">weight =</span> <span class="kw">sum</span>(weight)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># value of all sales in each province in each year</span></a>
<a class="sourceLine" id="cb45-10" title="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">share_prov =</span> <span class="kw">weights_scale</span>(weight)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># scale to sum to 1</span></a>
<a class="sourceLine" id="cb45-11" title="11"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>weight) <span class="co"># drop the weight column as it won&#39;t be needed again</span></a>
<a class="sourceLine" id="cb45-12" title="12"></a>
<a class="sourceLine" id="cb45-13" title="13"><span class="co"># Make product weights</span></a>
<a class="sourceLine" id="cb45-14" title="14">weights_prod &lt;-<span class="st"> </span>weights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-15" title="15"><span class="st">  </span><span class="co"># your code here %&gt;%</span></a>
<a class="sourceLine" id="cb45-16" title="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">share_prod =</span> <span class="kw">weights_scale</span>(weight)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-17" title="17"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>weight)</a></code></pre></div></li>
<li><p><strong>Calculate the geomean for product K</strong></p>
<p>Using the microdata for product K in the <code>dat_micro</code> file, calculate the geometric average of the prices in each province in each month in each reference year. This file should have 250 geomeans.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">dat_micro &lt;-<span class="st"> </span>dat_micro <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb46-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">period =</span> <span class="kw">year_month</span>(period)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># turn transaction dates into month-by-year dates</span></a>
<a class="sourceLine" id="cb46-3" title="3"><span class="st">  </span><span class="co"># your code here %&gt;%</span></a>
<a class="sourceLine" id="cb46-4" title="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">geomean =</span> <span class="kw">mean_geometric</span>(price)) <span class="co"># calculate the geometric avergage</span></a></code></pre></div></li>
<li><p><strong>Calculate the geomean for products A to J</strong></p>
<p>Using the data from the Globular Prices System in <code>dat_gps</code>, calculate the geometric average of the price quotes for each product in each province in each month in each reference year, for products A to J. Combine these data with the data prepared in step 2. The resulting file should have 2,500 geomeans.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">dat_index &lt;-<span class="st"> </span>dat_gps <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-2" title="2"><span class="st">  </span><span class="co"># your code here %&gt;%</span></a>
<a class="sourceLine" id="cb47-3" title="3"><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> <span class="st">&quot;quote&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;price&quot;</span>, price1<span class="op">:</span>price3) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># melt into a long dataset</span></a>
<a class="sourceLine" id="cb47-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(province, product, year, period) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-5" title="5"><span class="st">  </span><span class="co"># your code here %&gt;%</span></a>
<a class="sourceLine" id="cb47-6" title="6"><span class="st">  </span><span class="kw">bind_rows</span>(dat_micro) <span class="co"># append to dat_micro</span></a></code></pre></div></li>
<li><p><strong>Calculate the period-over-period elemental indices</strong></p>
<p>For each product in each province in each reference year, calculate the ratio of the geometric averages computed in step 3, making sure to have a price relative of 1 in January 2018 and January 2019. (January 2019 will be the link month when it is time to chain the index.)</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1">dat_index &lt;-<span class="st"> </span>dat_index <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb48-2" title="2"><span class="st">  </span><span class="co"># your code here (hint: read the documentation for dplyr::lag)</span></a></code></pre></div></li>
<li><p><strong>Price update the product weights</strong></p>
<p>Merge the product-by-province level weights from step 1 into the dataset created in step 4, and use the period-over-period elemental indices to price update the weights.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1">dat_index &lt;-<span class="st"> </span>dat_index <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb49-2" title="2"><span class="st">  </span><span class="co"># your code here %&gt;%</span></a>
<a class="sourceLine" id="cb49-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">share_prod_u =</span> <span class="kw">weights_update</span>(<span class="kw">cumprod</span>(<span class="kw">lag</span>(rel, <span class="dt">default =</span> <span class="dv">1</span>)), share_prod)) <span class="co"># price update the weights</span></a></code></pre></div></li>
<li><p><strong>Calculate the province-level index</strong></p>
<p>Calculate an arithmetic index for each province in each reference year, using the period-over-period elemental indices and the price updated weights from steps 4 and 5.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1">index_prov &lt;-<span class="st"> </span>dat_index <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(period, year, province) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-3" title="3"><span class="st">  </span><span class="co"># your code here</span></a></code></pre></div></li>
<li><p><strong>Calculate the Canada-level index</strong></p>
<p>Merge the province-level weights in step 1 with the provincial indices from step 6 to calculate a Canada-level index for each reference year.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">index &lt;-<span class="st"> </span>index_prov <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-2" title="2"><span class="st">  </span><span class="co"># your code here</span></a>
<a class="sourceLine" id="cb51-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(period, year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-4" title="4"><span class="st">  </span><span class="co"># your code here</span></a>
<a class="sourceLine" id="cb51-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># province 0 is the Canada-level</span></a>
<a class="sourceLine" id="cb51-6" title="6"><span class="st">  </span><span class="kw">bind_rows</span>(index_prov)</a></code></pre></div></li>
<li><p><strong>Chain the 2018 and 2019 indices</strong></p>
<p>Chain the 2018 and 2019 province-level and Canada-level indices together, using January 2019 as the link month, to get an index from January 2018 to December 2019 with January 2018 as the base period (usually the base period would be a calendar year, but there are only 24 months of data).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1">index_chain &lt;-<span class="st"> </span>index <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(province) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-3" title="3"><span class="st">  </span><span class="co"># your code here</span></a>
<a class="sourceLine" id="cb52-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(period, province) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-5" title="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">index =</span> <span class="kw">unique</span>(index)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove the duplicate rows for the link month</span></a>
<a class="sourceLine" id="cb52-6" title="6"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div></li>
</ol>
<p>The end result should be a file with 11 price indices, one for each province and a national index, from January 2018 to December 2019, with January 2018 as the base period (= 100).</p>
<p>Validating the Canada-level index requires putting the Canadian Regulatory Economic Analysis group’s index and Monsterweb’s index into a common form.</p>
<ol start="9" style="list-style-type: decimal">
<li><p><strong>Quarter the monthly indices</strong></p>
<p>Turn the index you just made and the Canadian Regulatory Economic Analysis group’s index in <code>index_crea</code> into a quarterly index, with quarter 1 2019 as the base period, by taking the average of the three index values in each quarter.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1">my_index &lt;-<span class="st"> </span>index_chain <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-2" title="2"><span class="st">  </span><span class="kw">filter</span>(province <span class="op">==</span><span class="st"> &#39;0&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># keep only the Canada-level index</span></a>
<a class="sourceLine" id="cb53-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">period =</span> <span class="kw">year_quarter</span>(period)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(period) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-5" title="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">index =</span> <span class="kw">mean</span>(index)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">index =</span> index<span class="op">/</span>index[period <span class="op">==</span><span class="st"> &#39;2019-01-01&#39;</span>] <span class="op">*</span><span class="st"> </span><span class="dv">100</span>) <span class="co"># rebase to Jan 2019</span></a>
<a class="sourceLine" id="cb53-7" title="7"></a>
<a class="sourceLine" id="cb53-8" title="8">index_crea &lt;-<span class="st"> </span>index_crea <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-9" title="9"><span class="st">  </span><span class="co"># your code here %&gt;%</span></a>
<a class="sourceLine" id="cb53-10" title="10"><span class="st">  </span><span class="co"># your code here %&gt;%</span></a>
<a class="sourceLine" id="cb53-11" title="11"><span class="st">  </span><span class="co"># your code here %&gt;%</span></a>
<a class="sourceLine" id="cb53-12" title="12"><span class="st">  </span><span class="co"># your code here %&gt;%</span></a>
<a class="sourceLine" id="cb53-13" title="13"><span class="st">  </span><span class="co"># your code here %&gt;%</span></a>
<a class="sourceLine" id="cb53-14" title="14"></a>
<a class="sourceLine" id="cb53-15" title="15">index_mw &lt;-<span class="st"> </span>index_mw <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-16" title="16"><span class="st">  </span><span class="co"># your code here</span></a></code></pre></div></li>
<li><p><strong>Append all three indices together</strong></p>
<p>Put the indices in step 9 together in one dataset with Monsterweb’s index in <code>index_mw</code>. They should all be quarterly with quarter 1 2019 as the base period (= 100).</p></li>
</ol>

</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="methodology.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["price-index-course.pdf"],
"toc": {
"collapse": "section"
},
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
